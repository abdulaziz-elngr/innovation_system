<?php
// Database connection
$conn = mysqli_connect("localhost", "root", "", "innovation_system");

// 1. Students who didn't leave (leave_time is NULL)
$res_students = mysqli_query($conn, "SELECT COUNT(*) as total FROM student_entry_archive WHERE leave_time IS NULL");
$count_students = mysqli_fetch_assoc($res_students)['total'];

// 2. Total Books
$res_books = mysqli_query($conn, "SELECT COUNT(*) as total FROM books");
$count_books = mysqli_fetch_assoc($res_books)['total'];

// 3. Total Categories
$res_cats = mysqli_query($conn, "SELECT COUNT(*) as total FROM category");
$count_cats = mysqli_fetch_assoc($res_cats)['total'];

// 4. Total Borrowings
$res_borrow = mysqli_query($conn, "SELECT COUNT(*) as total FROM borrowing_archive");
$count_borrow = mysqli_fetch_assoc($res_borrow)['total'];
?>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Innovation Library System</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <style>
        body {
            margin: 0;
            height: 100vh;
            background: url("images/library.jpg") no-repeat center center fixed;
            background-size: cover;
            font-family: Arial, sans-serif;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* Top Bar Adjusted for Clock and Date */
        .top-bar { 
            position: fixed; 
            top: 0; 
            width: 100%; 
            height: 70px; 
            background: rgba(0, 0, 0, 0.4); 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            color: white; 
            font-size: 26px; 
            font-weight: bold; 
            z-index: 10; 
        }

        .datetime-container {
            position: absolute;
            left: 20px;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            color: rgba(255, 255, 255, 0.9);
        }

        #liveClock { font-size: 22px; font-weight: bold; letter-spacing: 1px; }
        #spanishDate { font-size: 14px; font-weight: 300; text-transform: capitalize; color: #6f42c1; }

        .logo { position: fixed; top: 10px; right: 20px; z-index: 10; }
        .logo img { height: 50px; }

        /* Left Sidebar Stats Table */
        .stats-panel {
            position: fixed;
            left: 30px;
            top: 50%;
            transform: translateY(-50%);
            width: 280px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            padding: 20px;
            color: white;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            z-index: 5;
        }

        .stats-panel h3 { text-align: center; margin-top: 0; font-size: 18px; border-bottom: 1px solid rgba(255,255,255,0.2); padding-bottom: 10px; }
        .stats-row { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .stats-row:last-child { border-bottom: none; }
        .stats-label { font-size: 14px; display: flex; align-items: center; gap: 10px; }
        .stats-value { font-weight: bold; background: #6f42c1; padding: 2px 10px; border-radius: 8px; min-width: 30px; text-align: center; }

        .main-container { flex: 1; display: flex; justify-content: center; align-items: center; padding-left: 300px; padding-bottom: 80px; }
        .nav-grid { display: grid; grid-template-columns: repeat(2, 220px); grid-gap: 25px; }
        .nav-card { background: rgba(255, 255, 255, 0.15); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 20px; padding: 40px 20px; color: white; text-align: center; cursor: pointer; transition: 0.3s; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3); }
        .nav-card:hover { transform: translateY(-10px); background: rgba(255, 255, 255, 0.25); }
        .nav-card i { font-size: 45px; margin-bottom: 15px; display: block; }
        .nav-card span { font-weight: bold; font-size: 18px; display: block; }

        .bottom-bar { position: fixed; bottom: 0; width: 100%; height: 80px; background-color: #6f42c1; display: flex; z-index: 10; }
        .data-btn { flex: 1; color: white; text-decoration: none; display: flex; align-items: center; justify-content: center; gap: 10px; font-weight: bold; border-right: 1px solid rgba(255,255,255,0.2); transition: 0.3s; font-size: 20px; }
        .data-btn:hover { background: rgba(0, 0, 0, 0.15); }

        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); backdrop-filter: blur(10px); display: none; justify-content: center; align-items: center; z-index: 100; }
        .modal-content { background: rgba(255, 255, 255, 0.15); padding: 30px; border-radius: 25px; width: 450px; border: 1px solid rgba(255, 255, 255, 0.2); color: white; text-align: center; }
        .form-group { text-align: left; margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-size: 14px; }
        .form-group input, .form-group select { width: 100%; padding: 12px; border-radius: 10px; border: none; box-sizing: border-box; }
        .form-buttons { display: flex; gap: 15px; margin-top: 25px; }
        .save-btn { flex: 1; background: #6f42c1; color: white; border: none; padding: 12px; border-radius: 10px; cursor: pointer; font-weight: bold; }
        .back-btn { flex: 1; background: #424242; color: white; border: none; padding: 12px; border-radius: 10px; cursor: pointer; font-weight: bold; }
    </style>
</head>
<body>

<div class="top-bar">
    <div class="datetime-container">
        <div id="liveClock">00:00:00</div>
        <div id="spanishDate">Cargando fecha...</div>
    </div>
    Innovation Library System
</div>

<div class="logo"><img src="images/logo.png" alt="Logo"></div>

<div class="stats-panel">
    <h3><i class="fa-solid fa-chart-line"></i> Library Overview</h3>
    <div class="stats-row">
        <div class="stats-label"><i class="fa-solid fa-user-clock"></i> Students Inside</div>
        <div class="stats-value"><?php echo $count_students; ?></div>
    </div>
    <div class="stats-row">
        <div class="stats-label"><i class="fa-solid fa-book"></i> Total Books</div>
        <div class="stats-value"><?php echo $count_books; ?></div>
    </div>
    <div class="stats-row">
        <div class="stats-label"><i class="fa-solid fa-layer-group"></i> Total Categories</div>
        <div class="stats-value"><?php echo $count_cats; ?></div>
    </div>
    <div class="stats-row">
        <div class="stats-label"><i class="fa-solid fa-hand-holding-hand"></i> Total Borrowed</div>
        <div class="stats-value"><?php echo $count_borrow; ?></div>
    </div>
</div>

<div class="main-container">
    <div class="nav-grid">
        <div class="nav-card" onclick="openModal('book')"><i class="fa-solid fa-plus"></i><span>Add Book</span></div>
        <div class="nav-card" onclick="openModal('student')"><i class="fa-solid fa-user-graduate"></i><span>Student Entry</span></div>
        <div class="nav-card" onclick="openModal('category')"><i class="fa-solid fa-layer-group"></i><span>Add Category</span></div>
        <div class="nav-card" onclick="openModal('borrow')"><i class="fa-solid fa-book-open"></i><span>Create Borrowing</span></div>
    </div>
</div>

<div class="bottom-bar">
    <a href="books.php" class="data-btn"><i class="fa-solid fa-book"></i> All Books</a>
    <a href="students.php" class="data-btn"><i class="fa-solid fa-users"></i> Student Data</a>
    <a href="category.php" class="data-btn"><i class="fa-solid fa-list"></i> All Category</a>
    <a href="borrowings.php" class="data-btn"><i class="fa-solid fa-chart-pie"></i> All Borrowings</a>
</div>

<div class="modal-overlay" id="mainModal">
    <div class="modal-content">
        <h2 id="modalTitle">Form</h2>
        <form id="dynamicForm" action="process.php" method="POST">
            <div id="formFields"></div>
            <div class="form-buttons">
                <button type="submit" class="save-btn">Save</button>
                <button type="button" class="back-btn" onclick="closeModal()">Back</button>
            </div>
        </form>
    </div>
</div>

<script>
    // --- 1. DIGITAL CLOCK & SPANISH DATE ---
    function updateDateTime() {
        const now = new Date();
        
        // Time: 12:30:45 PM format
        document.getElementById('liveClock').innerText = now.toLocaleTimeString('en-US', { 
            hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: true 
        });

        // Date: "lunes, 26 de enero de 2026" in Spanish
        const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
        document.getElementById('spanishDate').innerText = now.toLocaleDateString('es-ES', options);
    }
    setInterval(updateDateTime, 1000);
    updateDateTime();

    // --- 2. MODAL LOGIC ---
    const modal = document.getElementById('mainModal');
    const modalTitle = document.getElementById('modalTitle');
    const formFields = document.getElementById('formFields');

// Replace your existing formsConfig with this:
// Replace your existing formsConfig with this:
const formsConfig = {
    student: { 
        title: "Student Entry", 
        fields: `
            <input type="hidden" name="form_type" value="student">
            <div class="form-group"><label>Student Name</label><input type="text" name="s_name" required></div>
            <div class="form-group"><label>Student ID</label><input type="text" name="s_id" required></div>
            <div class="form-group"><label>College</label><select name="s_college"><option>Computer Science</option><option>Engineering</option></select></div>
            <div class="form-group"><label>Time</label><input type="time" name="s_time"></div>` 
    },
    borrow: { 
        title: "Create Borrowing", 
        fields: `
            <input type="hidden" name="form_type" value="borrow">
            <div class="form-group"><label>Student Name</label><input type="text" name="b_student"></div>
            <div class="form-group"><label>Student ID</label><input type="text" name="b_id"></div>
            <div class="form-group"><label>Phone Number</label><input type="text" name="b_phone"></div>
            <div class="form-group"><label>Book Name</label><input type="text" name="b_book"></div>
            <div class="form-group"><label>Day</label><select name="b_day"><option>Saturday</option><option>Sunday</option><option>Monday</option></select></div>
            <div class="form-group"><label>Number of Days</label><select name="b_duration"><option>1</option><option>2</option><option>3</option></select></div>` 
    },
    category: { 
        title: "Add Category", 
        fields: `
            <input type="hidden" name="form_type" value="category">
            <div class="form-group"><label>Category Name</label><input type="text" name="cat_name"></div>
            <div class="form-group"><label>Number of Books</label><input type="number" name="cat_count"></div>` 
    },
    book: { 
        title: "Add Book", 
        fields: `
            <input type="hidden" name="form_type" value="book">
            <div class="form-group"><label>Book Name</label><input type="text" name="bk_name"></div>
            <div class="form-group"><label>Author</label><input type="text" name="bk_author"></div>
            <div class="form-group"><label>Publishing House</label><input type="text" name="bk_Publishing_house"></div>
            <div class="form-group"><label>ISBN</label><input type="text" name="bk_isbn"></div>
            <div class="form-group"><label>Edition Number</label><input type="text" name="bk_edition_number"></div>
            <div class="form-group"><label>College</label><select name="bk_college"><option>Select College</option></select></div>` 
    }
};  function openModal(type) {
        modalTitle.innerText = formsConfig[type].title;
        formFields.innerHTML = formsConfig[type].fields;
        modal.style.display = 'flex';
    }

    function closeModal() { modal.style.display = 'none'; }
    window.onclick = (event) => { if (event.target == modal) closeModal(); }
</script>

</body>
</html>